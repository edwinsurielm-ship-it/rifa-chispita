<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gran Rifa Chispitas</title>

<style>
body { font-family: Arial; text-align: center; background: #f5f5f5; }
h1 { color: #e67e22; }
.contador { font-size: 20px; margin: 15px; font-weight: bold; }

.grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 8px;
  max-width: 600px;
  margin: auto;
}

.numero {
  padding: 10px;
  background: white;
  border: 1px solid black;
  border-radius: 5px;
  cursor: pointer;
}

.vendido {
  background: gray;
  color: white;
  text-decoration: line-through;
}

button { margin-top: 20px; padding: 10px 20px; font-size: 18px; }
</style>
</head>

<body>

<h1>ğŸ‰ Gran Rifa ğŸ‰</h1>

<p><b>Fecha:</b> 10 de marzo</p>
<p>Debe tener 70% vendidos para realizarse.</p>

<h2>ğŸ† PREMIOS</h2>
<p>Cachorra Pomerania (Chispitas)</p>

<div class="contador" id="contador"></div>

<h2>ğŸŸï¸ NÃºmeros</h2>
<div class="grid" id="numeros"></div>

<div id="adminPanel" style="display:none;">
<button onclick="girarTombola()">ğŸ° Girar TÃ³mbola</button>
</div>

<h2 id="ganador"></h2>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCevrXOgOd7pwRKbb6z9cBMkArhkZRxxnU",
  authDomain: "rifa-chispitas.firebaseapp.com",
  projectId: "rifa-chispitas",
  storageBucket: "rifa-chispitas.firebasestorage.app",
  messagingSenderId: "873610713673",
  appId: "1:873610713673:web:ca348a4bb09e70a8703d98"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = doc(db, "rifa", "datos");

const esAdmin = !/Mobi|Android|iPhone/i.test(navigator.userAgent);
if (esAdmin) document.getElementById("adminPanel").style.display = "block";

const contenedor = document.getElementById("numeros");

let vendidos = [];
let ganador = null;
  
  async function limpiarGanadorAlEntrar() {
  if (esAdmin) {
    await updateDoc(ref, { ganador: null });
    
onSnapshot(ref, (docu) => {
  const data = docu.data();

  vendidos = data.vendidos || [];
  ganador = data.ganador || null;

  dibujar();

  if (ganador) {
    document.getElementById("ganador").innerText =
      "ğŸ‰ GANADOR: NÃºmero " + ganador;
  } else {
    document.getElementById("ganador").innerText = "";
  }
});

function dibujar() {
  contenedor.innerHTML = "";

  for (let i = 1; i <= 100; i++) {
    const div = document.createElement("div");
    div.className = "numero";
    div.innerText = i;

    if (vendidos.includes(i)) div.classList.add("vendido");

    if (esAdmin) {
      div.onclick = async () => {
        if (vendidos.includes(i))
          vendidos = vendidos.filter(n => n != i);
        else
          vendidos.push(i);

        await updateDoc(ref, { vendidos });
      };
    }

    contenedor.appendChild(div);
  }
}

window.girarTombola = async () => {

  const todos = [];

  for (let i = 1; i <= 100; i++) {
    todos.push(i);
  }

  const g = todos[Math.floor(Math.random() * todos.length)];

  // ğŸ”¥ GUARDA GANADOR EN FIREBASE
  await updateDoc(ref, { ganador: g });

  // ğŸ”¥ BORRAR AUTOMATICAMENTE AL REFRESCAR
  setTimeout(async () => {
    await updateDoc(ref, { ganador: null });
  }, 8000);
};

function actualizarContador() {
  let fecha = new Date("2026-03-10");
  let hoy = new Date();
  let dias = Math.floor((fecha - hoy) / (1000 * 60 * 60 * 24));

  document.getElementById("contador").innerText =
    "â³ Faltan " + dias + " dÃ­as.";
}

actualizarContador();

</script>
</body>
</html>



